install.packages(c("BIS", "dplyr", "ggplot2", "zoo"))
install.packages("haven")
#Cerutti dataset
library(haven)
setwd("D:/OnlineDrive/OneDrive/Study/23.2019 Fall/Credit/200128")
data <- read_dta("House_finance_and_real_estate_booms_Cerutti_Dagher_DellAriccia_JHE2017_v2.dta")
View(data)
install.packages("DataCombine")
names(data)
labels(data)
setwd("~/GitHub/HPCredit/Data Collection")
setwd("D:/GitHub/HPCredit/Data Collection")
#Read raw data
df1 <- read.table("MergedData-Raw.txt", header=TRUE, sep=",")
df1 <- read.table("FCdummy.txt", header=TRUE, sep=",")
min(df1$date)
as.Date(df1$date)
min(df1$date)
min(as.Date((df1$date))
#List earliest date by ID
df1 %>%
group_by(ID) %>%
filter(date == min(date))
library(dplyr)
library(dplyr)
#List earliest date by ID
df1 %>%
group_by(ID) %>%
filter(date == min(date))
#List earliest date by ID
df1$date = as.Date(df1$date)
df1 %>%
group_by(ID) %>%
filter(date == min(date))
df6 <- read.table("HP_inc_gap.txt", header=TRUE, sep=",")
df6 %>%
group_by(ID) %>%
filter(date == min(date))
#List earliest date by ID
df6ate = as.Date(df6date)
#List earliest date by ID
df6$date = as.Date(df6$date)
df6 %>%
group_by(ID) %>%
filter(date == min(date))
install.packages(c("AER", "tidyverse"))
install.packages(c("IMFData", "imfr", "mFilter", "OECD", "plm", "quantmod", "reshape"))
library("readxl")
library(reshape)
library(mFilter)
#Import HP data downloaded from Dallas Fed
setwd("D:/GitHub/HPCredit/Data Collection")
HPI = read_excel("HPI.xlsx")
PDI = read_excel("PDI.xlsx")
#View(HPI)
#Cleaning up data
HPI = HPI[-c(1),]
HPI = HPI[,-((ncol(HPI)-1):ncol(HPI))] #select last columns
#data[,(ncol(data)-2):ncol(data)]
names(HPI)[1] = "date"
HPI = as.data.frame(HPI) #melt functions need data to be as data frame
HPI = melt(HPI, id="date")
names(HPI)[3] = "HPI"
#############
View(PDI)
PDI = PDI[-c(1),]
PDI = PDI[,-((ncol(PDI)-1):ncol(PDI))] #select last columns
names(PDI)[1] = "date"
PDI = as.data.frame(PDI) #melt functions need data to be as data frame
PDI = melt(PDI, id="date")
names(PDI)[3] = "PDI"
## Merge data
HPinc <- merge(HPI, PDI, by=c("variable","date"), all.x=TRUE)
names(HPinc)[1] = "ID"
HPinc$HPinc = HPinc$HPI/HPinc$PDI
write.table(HPinc, "HPinc_full.txt", sep=",")
HPinc1=subset(HPinc, select=-c(HPI,PDI))
write.table(HPinc, "HPinc.txt", sep=",")
HPinc1 <- HPinc1%>%
mutate(date = as.Date(as.yearqtr(date, "%Y:Q%q")))
ggplot(HPinc1, aes(date, HPinc1$HPinc, color = ID)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~ID) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "House Price to Income",
subtitle = "quarterly data")
## HP filter
HPinc1$ID = as.factor(HPinc1$ID)
df2 <- HPinc1
#df2 = as.ts(df2, c(2009, 1), end=c(2014, 12), frequency=12)
#How to make data equal length across country
library(reshape)
df3 = cast(df2, date~ID)
View(df3)
ggplot(HPinc1, aes(date, HPinc1$HPinc, color = ID)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~ID) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "House Price to Income",
subtitle = "quarterly data")
df4=df3
df4$date = as.character(df4$date)
df4 = as.data.frame(df4)
#Melt together
df5 = melt(df4, id.vars = "date", measure.vars = names(df4)[-1])
#df5 = melt(df3, id.vars = "date", measure.vars = names(df3)[-1])
#timeseries
#Tryout hpfilter
library(plm)
df6 <- df5 %>% group_by(variable) %>%
pdata.frame(., index = c("variable","date")) %>%
mutate(HHCredit_GDP_gap = value-mFilter::hpfilter(value, type = "lambda", freq = 400000)$trend)
names(df6)[2] = "ID"
names(df6)[4] = "HP_inc_gap"
write.table
write.table(df6[,c(1,2,4)], "HP_Inc_gap.txt", sep=',' )
df6$date = as.Date(df6$date)
#Graphing
ggplot(df6, aes(date, HP_inc_gap, color = ID)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~ID) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "Household Price",
subtitle = "as percentage of disposible income - HP decomp cycle | lambda=400000")
library(ggplot2)
#Graphing
ggplot(df6, aes(date, HP_inc_gap, color = ID)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~ID) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "Household Price",
subtitle = "as percentage of disposible income - HP decomp cycle | lambda=400000")
View(df6)
df6$date = as.Date(df6$date)
df6$date = as.Date(as.yearqtr(df6$date, "%Y:Q%q"))
library(dplyr)
df6$date = as.Date(as.yearqtr(df6$date, "%Y:Q%q"))
library(quantmod)
df6$date = as.Date(as.yearqtr(df6$date, "%Y:Q%q"))
#Graphing
ggplot(df6, aes(date, HP_inc_gap, color = ID)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~ID) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "Household Price",
subtitle = "as percentage of disposible income - HP decomp cycle | lambda=400000")
df6$date = as.yearqtr(df6$date, "%Y:Q%q")
as.Date(
df6$date = as.Date(as.yearqtr(df6$date, "%Y:Q%q"))
df6$date = as.Date(as.yearqtr(df6$date, "%Y:Q%q"))
library(dplyr)
library(ggplot2)
library(zoo)
library(BIS)
setwd("~/GitHub/HPCredit/Data Collection")
datasets <- BIS::get_datasets()
#head(datasets, 20)
#country list (with HP available)
clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|EE|FI|FR|GB|GR|HU|ID|IN|IE|IS|IL|IT|JP|KR|LT|LU|LV|MX|NL|NO|NZ|PL|PT|RO|RU|SA|RS|SK|SI|SE|TR|US|ZA
)"
rates <- get_bis(datasets$url[datasets$name == "Credit to the non-financial sector"], quiet = TRUE)
rates_plot <- rates %>%
mutate(date = as.Date(as.yearqtr(date, "%Y-q%q"))) %>%
filter(grepl(clist, borrowers_cty))%>%
filter(grepl("^(H)", tc_borrowers))%>%
filter(grepl("^(All sectors)", lending_sector))%>%
filter(grepl("^(770)", unit_type))
#%>%
#filter(grepl("^(U)", tc_adjust))
#%>%
#group_by(borrowers_cty) %>%
#mutate(growth = c(NA,diff(obs_value, lag = 4))*100/obs_value)
#table(rates_plot$ref_area)
#table(rates_plot$date)
#table(rates_plot$unit_type)
#table(rates_plot$tc_adjust)
ggplot(rates_plot, aes(date, obs_value, color = borrowers_country)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~borrowers_country) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "Credit to household",
subtitle = "as percentage of GDP")
#Saving Data
myvars <- c("borrowers_cty", "date", "obs_value")
df <- rates_plot[myvars]
names(df)[1]<-"ID"
names(df)[3]<-"HHCredit"
write.table(df, "HHCredit.txt", sep=",")
df$ID = as.factor(df$ID)
df2 <- df
#df2 = as.ts(df2, c(2009, 1), end=c(2014, 12), frequency=12)
#How to make data equal length across country
library(reshape)
df3 = cast(df2, date~ID)
library(dplyr)
library(ggplot2)
library(zoo)
library(BIS)
setwd("~/GitHub/HPCredit/Data Collection")
#Preparing Dataset
detach("package:OECD", unload = TRUE)
get_datasets = BIS::get_datasets
datasets <- get_datasets()
head(datasets, 20)
#country list
clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|EE|FI|FR|GB|GR|HU|ID|IN|IE|IS|IL|IT|JP|KR|LT|LU|LV|MX|NL|NO|NZ|PL|PT|RO|RU|SA|RS|SK|SI|SE|TR|US|ZA)"
#-----------------------
#House Price
#-----------------------
rates <- get_bis(datasets$url[datasets$name == "Property prices: selected series"], quiet = TRUE)
rates_plot <- rates %>%
mutate(date = as.Date(as.yearqtr(date, "%Y-q%q"))) %>%
filter(grepl(clist, ref_area))%>%
filter(grepl("^(R)", value))%>%
filter(grepl("^(Index, 2010 = 100)", unit_of_measure)) #771 vs 628
#table(rates_plot$ref_area)
#table(rates_plot$date)
#table(rates_plot$freq)
#table(rates_plot$value)
#table(rates_plot$unit_of_measure)
table(rates$unit_of_measure)
ggplot(rates_plot, aes(date, obs_value, color = reference_area)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~reference_area) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "Real House Price Growth Rate",
subtitle = "quarterly data")
write.table(rates_plot, "HP.txt", sep=",")
table(df$ID)
length(table(df$ID))
#as.yearqtr("2001 Q2")
#as.yearqtr("2001-q2","%Y-q%q") # same
library(dplyr)
library(ggplot2)
library(zoo)
library(BIS)
setwd("~/GitHub/HPCredit/Data Collection")
#Preparing Dataset
detach("package:OECD", unload = TRUE)
get_datasets = BIS::get_datasets
datasets <- get_datasets()
head(datasets, 20)
#country list
#clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|EE|FI|FR|GB|GR|HU|ID|IN|IE|IS|IL|IT|JP|KR|LT|LU|LV|MX|NL|NO|NZ|PL|PT|RO|RU|SA|RS|SK|SI|SE|TR|US|ZA)"
#modified clist to match HP from BIS
clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|FI|FR|GB|GR|HU|ID|IN|IS|IL|IT|JP|KR|LU|MX|NL|NO|NZ|PL|PT|RU|SA|SE|TR|US)"
#-----------------------
#House Price
#-----------------------
rates <- get_bis(datasets$url[datasets$name == "Property prices: selected series"], quiet = TRUE)
rates_plot <- rates %>%
mutate(date = as.Date(as.yearqtr(date, "%Y-q%q"))) %>%
filter(grepl(clist, ref_area))%>%
filter(grepl("^(R)", value))%>%
filter(grepl("^(Index, 2010 = 100)", unit_of_measure)) #771 vs 628
#table(rates_plot$ref_area)
#table(rates_plot$date)
#table(rates_plot$freq)
#table(rates_plot$value)
#table(rates_plot$unit_of_measure)
table(rates$unit_of_measure)
ggplot(rates_plot, aes(date, obs_value, color = reference_area)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~reference_area) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "Real House Price Growth Rate",
subtitle = "quarterly data")
library(dplyr)
library(ggplot2)
library(zoo)
library(BIS)
setwd("~/GitHub/HPCredit/Data Collection")
#Preparing Dataset
detach("package:OECD", unload = TRUE)
get_datasets = BIS::get_datasets
datasets <- get_datasets()
head(datasets, 20)
#country list
#clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|EE|FI|FR|GB|GR|HU|ID|IN|IE|IS|IL|IT|JP|KR|LT|LU|LV|MX|NL|NO|NZ|PL|PT|RO|RU|SA|RS|SK|SI|SE|TR|US|ZA)"
#modified clist to match HP from BIS
clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|FI|FR|GB|GR|HU|ID|IN|IL|IT|JP|KR|LU|MX|NL|NO|NZ|PL|PT|RU|SA|SE|TR|US)"
#-----------------------
#House Price
#-----------------------
rates <- get_bis(datasets$url[datasets$name == "Property prices: selected series"], quiet = TRUE)
rates_plot <- rates %>%
mutate(date = as.Date(as.yearqtr(date, "%Y-q%q"))) %>%
filter(grepl(clist, ref_area))%>%
filter(grepl("^(R)", value))%>%
filter(grepl("^(Index, 2010 = 100)", unit_of_measure)) #771 vs 628
#table(rates_plot$ref_area)
#table(rates_plot$date)
#table(rates_plot$freq)
#table(rates_plot$value)
#table(rates_plot$unit_of_measure)
table(rates$unit_of_measure)
ggplot(rates_plot, aes(date, obs_value, color = reference_area)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~reference_area) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "Real House Price Growth Rate",
subtitle = "quarterly data")
library(dplyr)
library(ggplot2)
library(zoo)
library(BIS)
setwd("~/GitHub/HPCredit/Data Collection")
datasets <- BIS::get_datasets()
#head(datasets, 20)
#country list (with HP available)
#clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|EE|FI|FR|GB|GR|HU|ID|IN|IE|IS|IL|IT|JP|KR|LT|LU|LV|MX|NL|NO|NZ|PL|PT|RO|RU|SA|RS|SK|SI|SE|TR|US|ZA)"
clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|EE|FI|FR|GB|GR|HU|ID|IN|IE|IS|IL|IT|JP|KR|LT|LU|LV|MX|NL|NO|NZ|PL|PT|RO|RU|RS|SK|SI|SE|TR|US|ZA)"
rates <- get_bis(datasets$url[datasets$name == "Credit to the non-financial sector"], quiet = TRUE)
rates_plot <- rates %>%
mutate(date = as.Date(as.yearqtr(date, "%Y-q%q"))) %>%
filter(grepl(clist, borrowers_cty))%>%
filter(grepl("^(H)", tc_borrowers))%>%
filter(grepl("^(All sectors)", lending_sector))%>%
filter(grepl("^(770)", unit_type))
#%>%
#filter(grepl("^(U)", tc_adjust))
#%>%
#group_by(borrowers_cty) %>%
#mutate(growth = c(NA,diff(obs_value, lag = 4))*100/obs_value)
#table(rates_plot$ref_area)
#table(rates_plot$date)
#table(rates_plot$unit_type)
#table(rates_plot$tc_adjust)
ggplot(rates_plot, aes(date, obs_value, color = borrowers_country)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~borrowers_country) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "Credit to household",
subtitle = "as percentage of GDP")
library(dplyr)
library(ggplot2)
library(zoo)
library(BIS)
setwd("~/GitHub/HPCredit/Data Collection")
datasets <- BIS::get_datasets()
#head(datasets, 20)
#country list (with HP available)
#clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|EE|FI|FR|GB|GR|HU|ID|IN|IE|IS|IL|IT|JP|KR|LT|LU|LV|MX|NL|NO|NZ|PL|PT|RO|RU|SA|RS|SK|SI|SE|TR|US|ZA)"
clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|EE|FI|FR|GB|GR|HU|ID|IN|IE|IS|IL|IT|JP|KR|LT|LU|LV|MX|NL|NO|NZ|PL|PT|RO|RU|RS|SK|SI|SE|TR|US)"
rates <- get_bis(datasets$url[datasets$name == "Credit to the non-financial sector"], quiet = TRUE)
rates_plot <- rates %>%
mutate(date = as.Date(as.yearqtr(date, "%Y-q%q"))) %>%
filter(grepl(clist, borrowers_cty))%>%
filter(grepl("^(H)", tc_borrowers))%>%
filter(grepl("^(All sectors)", lending_sector))%>%
filter(grepl("^(770)", unit_type))
#%>%
#filter(grepl("^(U)", tc_adjust))
#%>%
#group_by(borrowers_cty) %>%
#mutate(growth = c(NA,diff(obs_value, lag = 4))*100/obs_value)
#table(rates_plot$ref_area)
#table(rates_plot$date)
#table(rates_plot$unit_type)
#table(rates_plot$tc_adjust)
ggplot(rates_plot, aes(date, obs_value, color = borrowers_country)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~borrowers_country) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "Credit to household",
subtitle = "as percentage of GDP")
library(dplyr)
library(ggplot2)
library(zoo)
library(BIS)
setwd("~/GitHub/HPCredit/Data Collection")
#Preparing Dataset
detach("package:OECD", unload = TRUE)
get_datasets = BIS::get_datasets
datasets <- get_datasets()
head(datasets, 20)
#country list
#clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|EE|FI|FR|GB|GR|HU|ID|IN|IE|IS|IL|IT|JP|KR|LT|LU|LV|MX|NL|NO|NZ|PL|PT|RO|RU|SA|RS|SK|SI|SE|TR|US|ZA)"
#modified clist to match HP from BIS
clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|FI|FR|GB|GR|HU|ID|IN|IL|IT|JP|KR|LU|MX|NL|NO|NZ|PL|PT|RU|SA|SE|TR|US)"
#-----------------------
#House Price
#-----------------------
rates <- get_bis(datasets$url[datasets$name == "Property prices: selected series"], quiet = TRUE)
rates_plot <- rates %>%
mutate(date = as.Date(as.yearqtr(date, "%Y-q%q"))) %>%
filter(grepl(clist, ref_area))%>%
filter(grepl("^(R)", value))%>%
filter(grepl("^(Index, 2010 = 100)", unit_of_measure)) #771 vs 628
#table(rates_plot$ref_area)
#table(rates_plot$date)
#table(rates_plot$freq)
#table(rates_plot$value)
#table(rates_plot$unit_of_measure)
table(rates$unit_of_measure)
ggplot(rates_plot, aes(date, obs_value, color = reference_area)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~reference_area) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "Real House Price Growth Rate",
subtitle = "quarterly data")
library(dplyr)
library(ggplot2)
library(zoo)
library(BIS)
setwd("~/GitHub/HPCredit/Data Collection")
#Preparing Dataset
detach("package:OECD", unload = TRUE)
get_datasets = BIS::get_datasets
datasets <- get_datasets()
head(datasets, 20)
#country list
#clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|EE|FI|FR|GB|GR|HU|ID|IN|IE|IS|IL|IT|JP|KR|LT|LU|LV|MX|NL|NO|NZ|PL|PT|RO|RU|SA|RS|SK|SI|SE|TR|US|ZA)"
#modified clist to match HP from BIS
clist = "^(AT|AU|BE|BR|CA|CH|CL|CN|CO|CR|CZ|DE|DK|ES|FI|FR|GB|GR|HU|IE|ID|IN|IL|IT|JP|KR|LU|MX|NL|NO|NZ|PL|PT|RU|SA|SE|TR|US)"
#-----------------------
#House Price
#-----------------------
rates <- get_bis(datasets$url[datasets$name == "Property prices: selected series"], quiet = TRUE)
rates_plot <- rates %>%
mutate(date = as.Date(as.yearqtr(date, "%Y-q%q"))) %>%
filter(grepl(clist, ref_area))%>%
filter(grepl("^(R)", value))%>%
filter(grepl("^(Index, 2010 = 100)", unit_of_measure)) #771 vs 628
#table(rates_plot$ref_area)
#table(rates_plot$date)
#table(rates_plot$freq)
#table(rates_plot$value)
#table(rates_plot$unit_of_measure)
table(rates$unit_of_measure)
ggplot(rates_plot, aes(date, obs_value, color = reference_area)) +
geom_hline(yintercept = 0, linetype = "dashed",
color = "grey70", size = 0.02) +
geom_line(show.legend = FALSE) +
facet_wrap(~reference_area) +
theme_light() +
theme(panel.grid = element_blank()) +
labs(x = NULL, y = NULL,
title = "Real House Price Growth Rate",
subtitle = "quarterly data")
